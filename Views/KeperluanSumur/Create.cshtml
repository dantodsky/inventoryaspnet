@model List<InventoryManagement.Models.KeperluanSumur>

@{
    ViewData["Title"] = "Tambah Keperluan Sumur";
    var sumurs = ViewData["Sumurs"] as IEnumerable<InventoryManagement.Models.Sumur>;
    var stockBarangs = ViewData["StockBarangs"] as IEnumerable<InventoryManagement.Models.StockBarang>;
}

<h1>@ViewData["Title"]</h1>

<form method="post">
    <!-- Pilih Sumur -->
    <div class="form-group">
        <label>Pilih Sumur</label>
        <select id="sumurSelect" class="form-control" required>
            <option value="">-- Pilih Sumur --</option>
            @foreach (var sumur in sumurs)
            {
                <option value="@sumur.IdSumur">@sumur.NamaSumur (@sumur.DaerahSumur)</option>
            }
        </select>
    </div>

    <!-- Container untuk input material -->
    <div id="materials-container">
        <div class="form-group material-entry">
            <input type="hidden" name="keperluanSumurs[0].IdSumur" value="" class="sumur-id-input" />
            
            <label>Material</label>
            <select name="keperluanSumurs[0].KodeMaterial" class="form-control" required>
                <option value="">-- Pilih Material --</option>
                @foreach (var stock in stockBarangs)
                {
                    <option value="@stock.KodeMaterial">@stock.KodeMaterial - @stock.DeskripsiMaterial</option>
                }
            </select>

            <label>Jumlah</label>
            <input type="number" name="keperluanSumurs[0].Jumlah" class="form-control" required />
        </div>
    </div>

    <!-- Tombol Tambah Material -->
    <button type="button" id="add-material" class="btn btn-secondary mt-3">Tambah Material</button>
    <button type="submit" class="btn btn-primary mt-3">Simpan</button>
</form>

<script>
    let materialIndex = 0;

    // Update IdSumur secara otomatis ke semua material
    document.getElementById('sumurSelect').addEventListener('change', (e) => {
        const sumurId = e.target.value;
        document.querySelectorAll('.sumur-id-input').forEach(input => {
            input.value = sumurId;
        });
    });

    // Tambah Material Baru
    document.getElementById('add-material').addEventListener('click', () => {
        materialIndex++;
        const container = document.getElementById('materials-container');
        const newMaterial = container.querySelector('.material-entry').cloneNode(true);

        // Perbarui name untuk input baru
        newMaterial.querySelector('select').name = `keperluanSumurs[${materialIndex}].KodeMaterial`;
        newMaterial.querySelector('input[type="number"]').name = `keperluanSumurs[${materialIndex}].Jumlah`;
        newMaterial.querySelector('.sumur-id-input').name = `keperluanSumurs[${materialIndex}].IdSumur`;

        container.appendChild(newMaterial);
    });
</script>
